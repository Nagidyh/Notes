# DevOps 初步概念

[TOC]

## Code Review

通过合理的 Git Flow 和规范来管理代码的质量。

常见代码质量问题

- 英语拼写错误
- 泄露密码
- 无效注释
- 魔法数字
- hard code（写死）
- 缩进等代码风格问题

### 如何解决代码质量问题

第一步是锁定主干，禁止直接提交，采用多分支开发。先拉取一个分支，修改代码并推送分支，然后发起一个合并请求，**请同事进行代码评审**了。比较高级的技巧是推代码时自动创建一个合并请求，合并后临时分支被自动删除。

需要注意每次提交代码只提交最小粒度的一件事，即「**原子性提交**」，而不要把几件事做完一次性提交。比如有三件事，其中一件是修 Bug，结果修的有问题要回滚。如果三件事分三次提交，就可以轻松回滚有问题的，另外两个正确的不受影响；而一起提交的话就没法回滚。

Code Review 一定是在每次代码合并进去之前进行评审，发现问题减少故障，如果错误的代码已经合并上线了，这个时候再看就叫「故障反思会」而不叫「Code Review」，就没有意义了。

**Git workflow**

[![img](https://notes-image-host.oss-cn-beijing.aliyuncs.com/img/20210604115140.png)](https://help-assets.codehub.cn/enterprise/20210604115140.png)

单兵作战的时代就如上图所示，一个人提交代码，不需要什么工作流，一直往主干里提交就可以。而现在多人协作做项目时，每个人都往主干里提交就会产生冲突。如下图所示，多分支开发，每个需求每个 Bug 都拉一个小分支，开发完毕再合并进主干里。

有两种常用的工作流，第一种最简单叫：Feature branch workflow（需求分支工作流）。可以从下图中看到主分支里拉下来两个分支，一个做登录，一个做支付。登录做完就合并进去，后续有个短信的 bug 修复了，也合并进去后就发布了，但支付功能还在开发，这时就会出现问题。本来登录和支付要一起上线，表示同一时期同一阶段的两个功能相互有依赖，结果因为线上的短信 bug 修复，就把登录先带上线了，这就导致了问题，所以大项目不适合用这种模式，而是使用第二种。

[![img](https://notes-image-host.oss-cn-beijing.aliyuncs.com/img/20210604115203.png)](https://help-assets.codehub.cn/enterprise/20210604115203.png)

简易 Git Flow 是双分支的开发模式，除主分支外还有一个 develop 分支。Develop 分支对应敏捷开发里的迭代，每次迭代都会创建一个 develop，这次迭代里的所有功能开发完都合并到 develop，而不会合到主干上。主干保持随时可发布的状态，有 Bug 就在主干上修，等这次迭代全部结束，再把 develop 合到主干上。
